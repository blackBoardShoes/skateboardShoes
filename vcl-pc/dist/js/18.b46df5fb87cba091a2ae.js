webpackJsonp([18],{jSNw:function(e,t){},uTEB:function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var a=r("Xxa5"),n=r.n(a),s=r("exGp"),l=r.n(s),i=r("sF3y"),o={name:"system_detail_user",data:function(){var e=this;return{searchUser:"",tableData:[],memoryTable:[],dialogTableVisible:!1,typeOptions:[],newUser:{name:"",gender:"",department:"",institution:"",type:""},nameArr:[],permissionData:[{page:"系统首页",administrator:"√",doctor:"√",scientificManager:"√",controller:"√",dtenter:"√",nurse:"√"},{page:"患者中心",administrator:"√",doctor:"√",scientificManager:"√",controller:"√",dtenter:"√",nurse:"√"},{page:"任务中心",administrator:"×",doctor:"×",scientificManager:"√",controller:"√",dtenter:"√",nurse:"√"},{page:"数据统计",administrator:"√",doctor:"√",scientificManager:"√",controller:"×",dtenter:"×",nurse:"×"},{page:"项目管理",administrator:"√",doctor:"√",scientificManager:"√",controller:"×",dtenter:"×",nurse:"×"},{page:"表单管理",administrator:"√",doctor:"×",scientificManager:"×",controller:"×",dtenter:"×",nurse:"×"},{page:"系统管理",administrator:"√",doctor:"×",scientificManager:"√",controller:"×",dtenter:"×",nurse:"×"},{page:"帮助中心",administrator:"√",doctor:"√",scientificManager:"√",controller:"√",dtenter:"√",nurse:"√"}],rules:{name:[{validator:function(t,r,a){""===r?a(new Error("必填项不能为空")):(e.nameArr.indexOf(r)>-1&&a(new Error("该用户名已存在")),a())},trigger:"blur"},{required:!0}],institution:[{required:!0,message:"必填项不能为空",trigger:"change"}],type:[{required:!0,message:"必填项不能为空",trigger:"change"}]}}},methods:{search:function(){if(this.searchUser){var e=this.searchUser,t=[];this.tableData.forEach(function(r,a){(r.username.indexOf(e)>-1||r.name.indexOf(e)>-1)&&t.push(r)}),this.tableData=t}else this.tableData=this.memoryTable},cancel:function(){this.dialogTableVisible=!1,this.$refs.newUserForm.resetFields()},clearDepartment:function(){this.newUser.department="",this.newUser.gender=""},confirmAdd:function(){var e=this;return l()(n.a.mark(function t(){return n.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:e.$refs.newUserForm.validate(function(){var t=l()(n.a.mark(function t(r){var a,s;return n.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:if(!r){t.next=9;break}return(a=e.newUser).institution_name=a.institution,t.next=5,Object(i.a)(a);case 5:"SUCCESS"===(s=t.sent).data.mitiStatus?(e.getAllUser(),e.$refs.newUserForm.resetFields(),e.dialogTableVisible=!1):e.$message.error("ERROR: "+s.data.message),t.next=10;break;case 9:return t.abrupt("return",!1);case 10:case"end":return t.stop()}},t,e)}));return function(e){return t.apply(this,arguments)}}());case 1:case"end":return t.stop()}},t,e)}))()},forbiddenClass:function(e,t){if("禁用"===e.row.status)return"forbidden"},showOperate:function(e){var t=e.status,r=e.type,a=this.$store.state.user.type;return"禁用"!==t&&("管理员"!==r&&("管理员"===a||"科研管理员"===a&&"科研管理员"!==r))},filterTag1:function(e,t){return t.type===e},filterTag2:function(e,t){return t.department===e},filterTag3:function(e,t){return t.status===e},getAllUser:function(){var e=this;return l()(n.a.mark(function t(){var r,a,s,l,o,c,u;return n.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return r={currentPage:1,pageSize:500},t.next=3,Object(i.e)(r);case 3:if("SUCCESS"===(a=t.sent).data.mitiStatus){for(u in s=a.data.entity.data,l=[],o=function(e){s.forEach(function(t){t.type===e&&l.push(t)})},c={type1:"医生",type2:"科研护士",type3:"诊疗中心",type4:"临床质控员",type5:"科研管理员",type6:"管理员"})o(c[u]);e.tableData=l,e.memoryTable=e.tableData,e.nameArr=[],e.tableData.forEach(function(t){e.nameArr.push(t.name)})}else e.$message.error("ERROR: "+a.data.message);case 5:case"end":return t.stop()}},t,e)}))()},banUser:function(e){var t=this;return l()(n.a.mark(function r(){return n.a.wrap(function(r){for(;;)switch(r.prev=r.next){case 0:t.$confirm("操作将禁用  "+e.name+"  用户，是否继续？","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(l()(n.a.mark(function r(){var a;return n.a.wrap(function(r){for(;;)switch(r.prev=r.next){case 0:return r.next=2,Object(i.d)(e.id);case 2:"SUCCESS"===(a=r.sent).data.mitiStatus?t.getAllUser():console.log(a.data);case 4:case"end":return r.stop()}},r,t)}))).catch(function(){return!1});case 1:case"end":return r.stop()}},r,t)}))()},resetUser:function(e){var t=this;return l()(n.a.mark(function r(){return n.a.wrap(function(r){for(;;)switch(r.prev=r.next){case 0:t.$confirm("操作将重置  "+e.name+"  的用户密码，是否继续？","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(l()(n.a.mark(function r(){var a;return n.a.wrap(function(r){for(;;)switch(r.prev=r.next){case 0:return r.next=2,Object(i.g)(e.id);case 2:"SUCCESS"===(a=r.sent).data.mitiStatus?(console.log(a),t.getAllUser()):console.log(a.data);case 4:case"end":return r.stop()}},r,t)}))).catch(function(){return!1});case 1:case"end":return r.stop()}},r,t)}))()}},mounted:function(){null!==this.$store.state.user&&(1===this.$store.state.user.codetype?(this.typeOptions=["科研管理员","科研护士","诊疗中心","临床质控员","医生"],this.getAllUser()):2===this.$store.state.user.codetype?(this.typeOptions=["科研护士","诊疗中心","临床质控员","医生"],this.getAllUser()):this.$router.push("/error:401"))},watch:{searchUser:{handler:function(e){this.search()},deep:!0}}},c={render:function(){var e=this,t=e.$createElement,r=e._self._c||t;return r("div",{attrs:{id:"system-user"}},[r("div",{staticClass:"operate-buttons align-right"},[r("el-col",{attrs:{span:6}},[r("el-input",{attrs:{size:"medium",placeholder:"搜索成员",clearable:""},model:{value:e.searchUser,callback:function(t){e.searchUser=t},expression:"searchUser"}},[r("i",{staticClass:"ercp-icon-general-search el-input__icon",attrs:{slot:"prefix"},on:{click:e.search},slot:"prefix"})])],1),e._v(" "),r("el-button",{attrs:{size:"medium",type:"primary"},on:{click:function(t){e.dialogTableVisible=!0}}},[e._v("新增用户")])],1),e._v(" "),r("div",{staticClass:"user-table"},[r("el-table",{staticClass:"absolute-table",staticStyle:{width:"100%"},attrs:{data:e.tableData,height:"100%",size:"medium",fit:"","row-class-name":e.forbiddenClass}},[r("el-table-column",{attrs:{"show-overflow-tooltip":"",fixed:"",prop:"username",align:"center",label:"账号"}}),e._v(" "),r("el-table-column",{attrs:{"min-width":"100","show-overflow-tooltip":"",prop:"type",align:"center",label:"用户类型",filters:[{text:"管理员",value:"管理员"},{text:"科研管理员",value:"科研管理员"},{text:"医生",value:"医生"},{text:"诊疗中心",value:"诊疗中心"},{text:"科研护士",value:"科研护士"},{text:"临床质控员",value:"临床质控员"}],"filter-method":e.filterTag1}}),e._v(" "),r("el-table-column",{attrs:{"show-overflow-tooltip":"",prop:"name",align:"center",label:"姓名"}}),e._v(" "),r("el-table-column",{attrs:{"show-overflow-tooltip":"",prop:"gender",align:"center",label:"性别"}}),e._v(" "),r("el-table-column",{attrs:{"show-overflow-tooltip":"",prop:"department",align:"center",label:"科室",filters:[{text:"外科一",value:"外科一"},{text:"外科二",value:"外科二"},{text:"特需外科",value:"特需外科"}],"filter-method":e.filterTag2}}),e._v(" "),r("el-table-column",{attrs:{prop:"institution",align:"center",label:"机构","show-overflow-tooltip":""}}),e._v(" "),r("el-table-column",{attrs:{"min-width":"100","show-overflow-tooltip":"",prop:"createDate",align:"center",sortable:"",label:"创建日期"}}),e._v(" "),r("el-table-column",{attrs:{"show-overflow-tooltip":"",prop:"status",align:"center",label:"状态",filters:[{text:"正常",value:"正常"},{text:"禁用",value:"禁用"}],"filter-method":e.filterTag3,width:"120"}}),e._v(" "),r("el-table-column",{attrs:{prop:"operate",align:"center",label:"操作",fixed:"right",width:"180"},scopedSlots:e._u([{key:"default",fn:function(t){return e.showOperate(t.row)?[r("el-button",{attrs:{type:"danger",size:"small",plain:""},on:{click:function(r){e.banUser(t.row)}}},[e._v("禁用")]),e._v(" "),r("el-button",{attrs:{type:"primary",size:"small",plain:""},on:{click:function(r){e.resetUser(t.row)}}},[e._v("重置密码")])]:void 0}}])})],1)],1),e._v(" "),r("el-dialog",{attrs:{title:"新增用户",visible:e.dialogTableVisible,modal:!0,"append-to-body":"",width:"600px",center:""},on:{"update:visible":function(t){e.dialogTableVisible=t}}},[r("el-form",{ref:"newUserForm",attrs:{rules:e.rules,model:e.newUser,"label-position":"left","label-width":"100px"}},[r("el-col",{attrs:{span:23}},[r("el-form-item",{attrs:{label:"用户类型:",prop:"type"}},[r("el-select",{staticStyle:{width:"100%"},on:{change:e.clearDepartment},model:{value:e.newUser.type,callback:function(t){e.$set(e.newUser,"type",t)},expression:"newUser.type"}},e._l(e.typeOptions,function(e){return r("el-option",{key:e,attrs:{label:e,value:e}})}))],1)],1),e._v(" "),r("el-col",{attrs:{span:1}},[r("div",{staticClass:"tips"},[r("el-popover",{attrs:{placement:"bottom",width:"800",trigger:"hover"}},[r("el-table",{attrs:{data:e.permissionData,border:"",stripe:""}},[r("el-table-column",{attrs:{align:"center",property:"page",label:"页面/用户"}}),e._v(" "),r("el-table-column",{attrs:{align:"center",property:"administrator",label:"管理员"}}),e._v(" "),r("el-table-column",{attrs:{align:"center",property:"doctor",label:"医生"}}),e._v(" "),r("el-table-column",{attrs:{align:"center",property:"scientificManager",label:"科研管理员"}}),e._v(" "),r("el-table-column",{attrs:{align:"center",property:"controller",label:"临床质控员"}}),e._v(" "),r("el-table-column",{attrs:{align:"center",property:"dtenter",label:"诊疗中心"}}),e._v(" "),r("el-table-column",{attrs:{align:"center",property:"nurse",label:"科研护士"}})],1),e._v(" "),r("span",{staticClass:"el-icon-question",attrs:{slot:"reference"},slot:"reference"})],1)],1)]),e._v(" "),r("el-col",{attrs:{span:23}},[r("el-form-item",{attrs:{label:"用户机构:",prop:"institution"}},[r("el-select",{staticStyle:{width:"100%"},model:{value:e.newUser.institution,callback:function(t){e.$set(e.newUser,"institution",t)},expression:"newUser.institution"}},[r("el-option",{attrs:{label:"兰州大学第一医院",value:"兰州大学第一医院"}})],1)],1)],1),e._v(" "),r("el-col",{attrs:{span:23}},[r("el-form-item",{attrs:{label:"用户姓名:",prop:"name"}},[r("el-input",{attrs:{placeholder:"请输入用户姓名"},model:{value:e.newUser.name,callback:function(t){e.$set(e.newUser,"name",t)},expression:"newUser.name"}})],1)],1),e._v(" "),r("el-col",{attrs:{span:23}},[r("el-form-item",{attrs:{label:"用户科室:",prop:"department"}},[r("el-select",{staticStyle:{width:"100%"},attrs:{disabled:"医生"!==e.newUser.type},model:{value:e.newUser.department,callback:function(t){e.$set(e.newUser,"department",t)},expression:"newUser.department"}},[r("el-option",{attrs:{label:"外科一",value:"外科一"}}),e._v(" "),r("el-option",{attrs:{label:"外科二",value:"外科二"}}),e._v(" "),r("el-option",{attrs:{label:"特需外科",value:"特需外科"}})],1)],1)],1),e._v(" "),r("el-col",{attrs:{span:23}},[r("el-form-item",{attrs:{label:"用户性别:",prop:"gender"}},[r("el-radio-group",{attrs:{disabled:"诊疗中心"===e.newUser.type},model:{value:e.newUser.gender,callback:function(t){e.$set(e.newUser,"gender",t)},expression:"newUser.gender"}},[r("el-radio",{attrs:{label:"男",value:"男"}}),e._v(" "),r("el-radio",{attrs:{label:"女",value:"女"}})],1)],1)],1)],1),e._v(" "),r("div",{staticClass:"operate align-center clearfix",staticStyle:{width:"100%"}},[r("el-button",{attrs:{type:"info"},on:{click:e.cancel}},[e._v("取消")]),e._v(" "),r("el-button",{attrs:{type:"primary"},on:{click:e.confirmAdd}},[e._v("确定")])],1)],1)],1)},staticRenderFns:[]};var u=r("VU/8")(o,c,!1,function(e){r("jSNw")},"data-v-b7e4e404",null);t.default=u.exports}});