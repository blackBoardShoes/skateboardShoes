webpackJsonp([2],{Cdx3:function(e,t,a){var l=a("sB3e"),i=a("lktj");a("uqUo")("keys",function(){return function(e){return i(l(e))}})},GbGk:function(e,t,a){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var l=a("fZjL"),i=a.n(l),s=a("mvHQ"),n=a.n(s),r=a("Gu7T"),o=a.n(r),c=a("woOf"),d=a.n(c),u=a("Xxa5"),p=a.n(u),h=a("exGp"),v=a.n(h),f=a("zRAg"),m=a("tR1G"),g=a("gyMJ"),b=a("sICn").proxyTableApi.api,y=function(e){return g.a.post(b+"/formdata/export?fileName="+e.name,e.body)},_={name:"Project_detail_member",data:function(){return{hospitalRecords:[],hospitalExample:{field:{value:[],options:[]},relation:{value:"",options:[],type:""},target:{value:"",options:[],type:""}},basicInfomations:[],basicExample:{field:{value:[],options:[{label:"基本信息",value:"basic",children:[{label:"性别",value:"gender"},{label:"民族",value:"nation"},{label:"常住地址",value:"address"}]}],type:""},relation:{value:"",options:[{label:"等于",value:"equal"}],type:""},target:{value:[],options:[],type:""}},addressOption:[],recordTemplates:[],recordSelectOptions:[],relationOptions:[{type:["INPUT","TEXTAREA","CALCULATE","INT","DOUBLE"],typeOptions:[{label:"等于",value:"equal"},{label:"不等于",value:"not_equal"},{label:"大于",value:"greater_than"},{label:"小于",value:"less_than"},{label:"小于等于",value:"less_than_or_eq"},{label:"大于等于",value:"greater_than_or_eq"}]},{type:["RADIO","SELECT","RADIOTEXT"],typeOptions:[{label:"等于",value:"equal"},{label:"不等于",value:"not_equal"}]},{type:["CHECKBOX","SELECTMUTIPLE","CHECKBOXTEXT"],typeOptions:[{label:"包含",value:"has_all_of"},{label:"不包含",value:"hase_none_of"}]},{type:["CASCADER"],typeOptions:[{label:"等于",value:"equal"},{label:"不等于",value:"not_equal"}]},{type:["DATE"],typeOptions:[{label:"等于",value:"equal"},{label:"不等于",value:"not_equal"},{label:"大于",value:"greater_than"},{label:"小于",value:"less_than"},{label:"小于等于",value:"less_than_or_eq"},{label:"大于等于",value:"greater_than_or_eq"}]},{type:["DATETIME"],typeOptions:[{label:"等于",value:"equal"},{label:"不等于",value:"not_equal"},{label:"大于",value:"greater_than"},{label:"小于",value:"less_than"},{label:"小于等于",value:"less_than_or_eq"},{label:"大于等于",value:"greater_than_or_eq"}]}],leaveTime:[],operateTime:[],filterCases:[],defaultProps:{children:"children",label:"label"},fieldsData:[],choosenData:[],choosenField:[],choosenPhase:[],matchCases:[],afterFilter:!1,exportName:"",fileLists:[],thisFile:""}},mounted:function(){this.addressOption=f.a,this.getFormTemplate(),this.initComponent(this.hospitalRecords,this.hospitalExample),this.initComponent(this.basicInfomations,this.basicExample),this.getFileLists()},methods:{getFormTemplate:function(){var e=this;return v()(p.a.mark(function t(){var a;return p.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,Object(m.c)();case 2:"SUCCESS"===(a=t.sent).data.mitiStatus?(e.recordTemplates=a.data.entity,e.initFieldOptions()):e.$message.error("ERROR: "+a.data.message);case 4:case"end":return t.stop()}},t,e)}))()},filterPaients:function(e){var t=this;return v()(p.a.mark(function a(){var l,i;return p.a.wrap(function(a){for(;;)switch(a.prev=a.next){case 0:return a.next=2,s=e,g.a.post(b+"/formdata/inclusion?currentPage=1&perPage=50"+s.basic,s.record);case 2:"SUCCESS"===(l=a.sent).data.mitiStatus?(i=l.data.entity,t.matchCases=d()({},i),t.afterFilter=!0):t.$message.error("ERROR: "+l.data.message);case 4:case"end":return a.stop()}var s},a,t)}))()},beginCreate:function(e){var t=this;return v()(p.a.mark(function a(){var l;return p.a.wrap(function(a){for(;;)switch(a.prev=a.next){case 0:return a.next=2,y(e);case 2:"SUCCESS"===(l=a.sent).data.mitiStatus||t.$message.error("ERROR: "+l.data.message);case 4:case"end":return a.stop()}},a,t)}))()},getFileLists:function(){var e=this;return v()(p.a.mark(function t(){var a;return p.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,g.a.get(b+"/formdata/export_files");case 2:"SUCCESS"===(a=t.sent).data.mitiStatus?(e.fileLists=a.data.entity.reverse().splice(0,6),e.thisFile=e.fileLists.length>0?e.fileLists[0].file_id:""):e.$message.error("ERROR: "+a.data.message);case 4:case"end":return t.stop()}},t,e)}))()},downLoadFile:function(){var e=this;return v()(p.a.mark(function t(){var a,l,i,s,n;return p.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:if(a={},void 0===(l=e.fileLists.find(function(t){return t.file_id===e.thisFile}))){t.next=17;break}return a=d()({},{fileId:l.file_id,fileName:l.file_name}),t.next=6,r=a,Object(g.a)({url:b+"/formdata/download/"+r.fileId+"/"+r.fileName,method:"GET",responseType:"blob"});case 6:i=t.sent,s=window.URL.createObjectURL(i.data),(n=document.createElement("a")).href=s,n.download=l.file_name+".zip",document.body.appendChild(n),n.click(),document.body.removeChild(n),t.next=18;break;case 17:e.$message.info("请选择要导出的文件");case 18:case"end":return t.stop()}var r},t,e)}))()},initFieldOptions:function(){var e=[].concat(o()(this.recordTemplates)),t=[{value:"住院基本情况",label:"住院基本情况",phase:"住院基本情况",children:[]},{value:"术前",label:"术前",phase:"术前",children:[]},{value:"术中",label:"术中",phase:"术中",children:[]},{value:"术后",label:"术后",phase:"术后",children:[]},{value:"出院综合评估",label:"出院综合评估",phase:"出院综合评估",children:[]},{value:"随访",label:"随访",phase:"随访",children:[]}];e.forEach(function(t,a){!0===t.isStatic&&e.splice(a,1)}),e.forEach(function(e){e.label=e.name,e.value=e.id,e.treeNode=e.id,e.fields.length>0&&(e.children=e.fields,e.children.forEach(function(t,a){"RADIO"!==t.type||t.values||e.children.splice(a,1)}),e.children.forEach(function(t,a,l){t.phase=e.phase,t.value=t.id,t.treeNode=e.treeNode+"."+t.id,t.reference=void 0!==t.values?t.values:void 0===t.children?[]:t.children,t.subFields&&t.subFields.length>0?(t.children=t.subFields,t.children.forEach(function(a){a.phase=e.phase,a.value=a.id,a.reference=void 0===a.values?void 0===a.children?[]:a.children:a.values,a.children=null,a.treeNode=t.treeNode+"."+a.id})):t.children=null})),t.forEach(function(t){t.value===e.phase&&t.children.push(e)})}),this.recordSelectOptions=[].concat(t),this.fieldsData=JSON.parse(n()([].concat(t))),this.fieldsData.forEach(function(e){e.children&&e.children.forEach(function(e){e.children&&e.children.forEach(function(e){"TABLE"===e.type&&e.children&&(e.children=null)})})})},changeRelaAndTarget:function(e,t){var a=e.value;if(0===a.length)this.hospitalRecords[t].relation={value:"",options:[],type:""},this.hospitalRecords[t].target.type={value:"",options:[],type:""};else{var l=this.recordTemplates.find(function(e){return e.id===a[1]});if(l){var i=l.fields.find(function(e){return e.id===a[2]});if(this.hospitalRecords[t].relation={value:"",options:[],type:i.type},this.hospitalRecords[t].target={value:"",options:i.reference,type:i.type},this.relationOptions[3].type.includes(i.type)&&(this.hospitalRecords[t].target.value=[]),i.children){var s=i.children.find(function(e){return e.id===a[3]});this.hospitalRecords[t].relation={value:"",options:[],type:s.type},this.hospitalRecords[t].target={value:"",options:s.reference,type:s.type},this.relationOptions[3].type.includes(s.type)&&(this.hospitalRecords[t].target.value=[])}}}},changeRelaAndTarget2:function(e,t){this.basicInfomations[t].target.value="",this.basicInfomations[t].relation.value="";var a=e.value[1];"gender"===a?this.basicInfomations[t].target.options=[{label:"男",value:1},{label:"女",value:0}]:"address"===a?(this.basicInfomations[t].target.value=[],this.basicInfomations[t].target.options=f.a):"nation"===a&&(this.basicInfomations[t].target.options=[{label:"汉族",value:"汉族"},{label:"回族",value:"回族"},{label:"藏族",value:"藏族"}])},initComponent:function(e,t){var a=d()({},t);e.push(a)},addOne:function(e){1===e?this.hospitalRecordsAble?this.initComponent(this.hospitalRecords,this.hospitalExample):this.$message.info("请先填写完毕当前一组住院记录筛选条件再新增"):this.basicInfomations.length>=3?this.$message.info("基本信息最多筛选三条不重复且不冲突的条件"):this.basicInfoAble?this.initComponent(this.basicInfomations,this.basicExample):this.$message.info("请先填写完毕当前一组基本信息筛选条件再新增")},deleteOne:function(e,t){1===e?this.hospitalRecords.length>1?this.hospitalRecords.splice(t,1):this.$message.info("不能再删除了"):this.basicInfomations.length>1?this.basicInfomations.splice(t,1):this.$message.info("不能再删除了")},searchCase:function(){var e=[];this.basicInfomations.forEach(function(t){var a=!0;for(var l in t)""!==t[l].value&&t[l].value!==[]||(a=!1);a&&e.push(t)});var t=[];this.hospitalRecords.forEach(function(e){var a=!0;for(var l in e)""!==e[l].value&&e[l].value!==[]||(a=!1);a&&t.push(e)});var a={"住院基本情况":{},"术前":{},"术中":{},"术后":{},"出院综合评估":{},"随访":{}};if(t.forEach(function(e){for(var t in a)if(e.field.value[0]===t){var l=e.field.value[1]+"."+e.field.value[e.field.value.length-1];a[t][l]={type:e.relation.value,value:e.target.value}}}),this.leaveTime&&this.leaveTime.length>0&&(a["出院综合评估"]["comprehensiveAssessment.dischargeDate"]={type:"between",value1:this.leaveTime[0],value2:this.leaveTime[1]}),this.operateTime&&this.operateTime.length>0){var l={type:"between",value1:this.operateTime[0],value2:this.operateTime[1]};a["术前"]["header.operationDate"]=l,a["术中"]["header.operationDate"]=l,a["术后"]["header.operationDate"]=l}var i="";e.forEach(function(e){"gender"===e.field.value[1]&&i.indexOf("gender")<0?i+="&gender="+e.target.value:"nation"===e.field.value[1]&&i.indexOf("nation")<0?i+="&ethnic="+e.target.value:"address"===e.field.value[1]&&i.indexOf("address")<0&&(i+="&address="+e.target.value[e.target.value.length-1])});var s={basic:i,record:a};this.filterPaients(s)},getCheckNodes:function(){this.choosenData=this.$refs.tree.getCheckedNodes(!0);var e=[],t=[];this.choosenData.forEach(function(a,l){a.phase,e.indexOf(a.phase)<0&&e.push(a.phase),a.treeNode?t.push(a.treeNode):t.push(a.id)}),this.choosenPhase=[].concat(e),this.choosenField=[].concat(t)},makeFile:function(){var e={body:{inclusion:d()({},this.matchCases),fields:this.choosenField,phases:this.choosenPhase},name:this.exportName};void 0!==this.fileLists.find(function(t){return t.file_name===e.name})?this.$message.info("该文件名已存在,请输入其他文件名以区别"):(this.beginCreate(e),this.getFileLists())}},watch:{hospitalRecords:{handler:function(e){this.hospitalExample={field:{value:[],options:[]},relation:{value:"",options:[],type:""},target:{value:"",options:[],type:""}};var t=!0;e.forEach(function(e){for(var a in e)""!==e[a].value&&e[a].value!==[]||(t=!1)}),this.hospitalRecordsAble=t},deep:!0},basicInfomations:{handler:function(e){this.basicExample={field:{value:[],options:[{label:"基本信息",value:"basic",phase:"基本信息",id:"基本信息",children:[{label:"性别",value:"gender",id:"gender",phase:"基本信息"},{label:"民族",value:"nation",id:"nation",phase:"基本信息"},{label:"常住地址",value:"address",id:"address",phase:"基本信息"}]}],type:""},relation:{value:"",options:[{label:"等于",value:"equal"}],type:""},target:{value:[],options:[],type:""}};var t=!0;e.forEach(function(e){for(var a in e)""!==e[a].value&&e[a].value!==[]||(t=!1)}),this.basicInfoAble=t},deep:!0}},computed:{ableCreate:{get:function(){return""!==this.exportName&&i()(this.matchCases).length>0&&this.choosenData.length>0}}}},C={render:function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{attrs:{id:"project-member"}},[a("div",{staticClass:"filter er-card"},[a("div",{staticClass:"filter-head"},[e._v("\n      数据导出\n    ")]),e._v(" "),a("div",{staticClass:"filter-condition"},[e._l(e.basicInfomations,function(t,l){return a("div",{key:l+222,staticClass:"record-info-filter"},[a("div",{staticClass:"case"},[a("el-cascader",{staticStyle:{width:"100%"},attrs:{placeholder:"请选择基本信息字段",options:t.field.options},on:{change:function(a){e.changeRelaAndTarget2(t.field,l)}},model:{value:t.field.value,callback:function(a){e.$set(t.field,"value",a)},expression:"record.field.value"}})],1),e._v(" "),a("div",{staticClass:"case"},[t.field.value.length>0?a("el-select",{attrs:{placeholder:"请选择基本信息筛选"},model:{value:t.relation.value,callback:function(a){e.$set(t.relation,"value",a)},expression:"record.relation.value"}},e._l(t.relation.options,function(e){return a("el-option",{key:e.value,attrs:{label:e.label,value:e.value}})})):e._e()],1),e._v(" "),a("div",{staticClass:"case"},["gender"===t.field.value[1]||"nation"===t.field.value[1]?a("el-select",{staticStyle:{width:"95%"},attrs:{"allow-create":"nation"===t.field.value[1],filterable:"nation"===t.field.value[1],placeholder:"nation"===t.field.value[1]?"请选择或填写民族":"请选择性别"},model:{value:t.target.value,callback:function(a){e.$set(t.target,"value",a)},expression:"record.target.value"}},e._l(t.target.options,function(e){return a("el-option",{key:e.value,attrs:{label:e.label,value:e.value}})})):e._e(),e._v(" "),"address"===t.field.value[1]?a("el-cascader",{staticStyle:{width:"95%"},attrs:{"change-on-select":!0,options:e.addressOption,placeholder:"请选择常住地址"},model:{value:t.target.value,callback:function(a){e.$set(t.target,"value",a)},expression:"record.target.value"}}):e._e()],1),e._v(" "),a("div",{staticClass:"add-case"},[a("el-button",{staticClass:"ercp-icon-general-decrease",attrs:{type:"text",size:"mini"},on:{click:function(t){e.deleteOne(2,l)}}}),e._v(" "),a("el-button",{staticClass:"ercp-icon-general-append",attrs:{type:"text",size:"mini"},on:{click:function(t){e.addOne(2)}}})],1)])}),e._v(" "),e._l(e.hospitalRecords,function(t,l){return a("div",{key:l+111,staticClass:"basic-info-filter"},[a("div",{staticClass:"case"},[a("el-cascader",{staticStyle:{width:"100%"},attrs:{placeholder:"请选择住院信息字段",options:e.recordSelectOptions},on:{change:function(a){e.changeRelaAndTarget(t.field,l)}},model:{value:t.field.value,callback:function(a){e.$set(t.field,"value",a)},expression:"info.field.value"}})],1),e._v(" "),a("div",{staticClass:"case"},[""!==t.relation.type?a("el-select",{attrs:{placeholder:"请选择住院信息筛选"},model:{value:t.relation.value,callback:function(a){e.$set(t.relation,"value",a)},expression:"info.relation.value"}},e._l(e.relationOptions.find(function(e){return e.type.includes(t.relation.type)}).typeOptions,function(e){return a("el-option",{key:e.value,attrs:{label:e.label,value:e.value}})})):e._e()],1),e._v(" "),a("div",{staticClass:"case"},[e.relationOptions[0].type.includes(t.target.type)?a("el-input",{staticStyle:{width:"95%"},attrs:{placeholder:"请填写"},model:{value:t.target.value,callback:function(a){e.$set(t.target,"value",a)},expression:"info.target.value"}}):e._e(),e._v(" "),e.relationOptions[1].type.includes(t.target.type)||e.relationOptions[2].type.includes(t.target.type)?a("el-select",{staticStyle:{width:"95%"},attrs:{"collapse-tags":"","allow-create":"RADIOTEXT"===t.target.type||"CHECKBOXTEXT"===t.target.type,filterable:"RADIOTEXT"===t.target.type||"CHECKBOXTEXT"===t.target.type,multiple:"CHECKBOX"===t.target.type||"SELECTMUTIPLE"===t.target.type||"CHECKBOXTEXT"===t.target.type,placeholder:"请选择"+("RADIOTEXT"===t.target.type||"CHECKBOXTEXT"===t.target.type?"(或输入)":"")+("CHECKBOX"===t.target.type||"SELECTMUTIPLE"===t.target.type||"CHECKBOXTEXT"===t.target.type?"(可多选)":"")},model:{value:t.target.value,callback:function(a){e.$set(t.target,"value",a)},expression:"info.target.value"}},e._l(t.target.options,function(e){return a("el-option",{key:e.value,attrs:{label:e.label,value:e.value}})})):e._e(),e._v(" "),e.relationOptions[3].type.includes(t.target.type)?a("el-cascader",{staticStyle:{width:"95%"},attrs:{options:t.target.options,placeholder:"请选择"},model:{value:t.target.value,callback:function(a){e.$set(t.target,"value",a)},expression:"info.target.value"}}):e._e(),e._v(" "),e.relationOptions[4].type.includes(t.target.type)?a("el-date-picker",{staticStyle:{width:"95%"},attrs:{"value-format":"yyyy-MM-dd",type:"date",placeholder:"选择日期"},model:{value:t.target.value,callback:function(a){e.$set(t.target,"value",a)},expression:"info.target.value"}}):e._e(),e._v(" "),e.relationOptions[5].type.includes(t.target.type)?a("el-date-picker",{staticStyle:{width:"95%"},attrs:{"value-format":"yyyy-MM-dd HH:mm:ss",type:"datetime",placeholder:"选择日期时间"},model:{value:t.target.value,callback:function(a){e.$set(t.target,"value",a)},expression:"info.target.value"}}):e._e()],1),e._v(" "),a("div",{staticClass:"add-case"},[a("el-button",{staticClass:"ercp-icon-general-decrease",attrs:{type:"text",size:"mini"},on:{click:function(t){e.deleteOne(1,l)}}}),e._v(" "),a("el-button",{staticClass:"ercp-icon-general-append",attrs:{type:"text",size:"mini"},on:{click:function(t){e.addOne(1)}}})],1)])}),e._v(" "),a("div",{staticClass:"other-info-filter"},[a("div",{staticClass:"case1"},[a("span",{staticClass:"light-text"},[e._v("手术日期")]),e._v(" "),a("el-date-picker",{attrs:{type:"daterange","range-separator":"至",format:"yyyy/MM/dd","value-format":"yyyy/MM/dd","start-placeholder":"开始日期","end-placeholder":"结束日期"},model:{value:e.operateTime,callback:function(t){e.operateTime=t},expression:"operateTime"}})],1),e._v(" "),a("div",{staticClass:"case2"},[a("span",{staticClass:"light-text"},[e._v("出院日期")]),e._v(" "),a("el-date-picker",{attrs:{type:"daterange",format:"yyyy/MM/dd","value-format":"yyyy/MM/dd","range-separator":"至","start-placeholder":"开始日期","end-placeholder":"结束日期"},model:{value:e.leaveTime,callback:function(t){e.leaveTime=t},expression:"leaveTime"}})],1)]),e._v(" "),a("div",{staticClass:"operate-space"},[a("el-button",{attrs:{type:"primary",size:"medium"},on:{click:e.searchCase}},[e._v("开始检索")]),e._v(" "),e.afterFilter?a("span",{staticClass:"match-cases-len"},[e._v("经检索,共有\n          "),a("span",{staticClass:"primary-text"},[e._v(e._s(Object.keys(e.matchCases).length))]),e._v("\n          条符合筛选条件的记录\n        ")]):e._e()],1)],2),e._v(" "),a("div",{staticClass:"filter-tree filter-cases"},[e.fieldsData.length>0?a("div",{staticClass:"choosen-wrapper"},[e._v("\n        已选中"+e._s(e.choosenField.length)+"个字段\n      ")]):e._e(),e._v(" "),a("el-tree",{ref:"tree",attrs:{accordion:"",data:e.fieldsData,"show-checkbox":"","default-expand-all":!1,"node-key":"id","highlight-current":"",props:e.defaultProps,"empty-text":"loading"},on:{"check-change":e.getCheckNodes},scopedSlots:e._u([{key:"default",fn:function(t){t.node;var l=t.data;return a("span",{staticClass:"custom-tree-node",staticStyle:{"font-size":"13px"}},[a("span",[e._v(e._s(l.label)+e._s(l.type))])])}}])})],1),e._v(" "),a("div",{staticClass:"operate-space"},[a("el-input",{staticStyle:{width:"260px"},attrs:{type:"text",size:"medium",placeholder:"输入文件名"},model:{value:e.exportName,callback:function(t){e.exportName=t},expression:"exportName"}}),e._v(" "),a("el-button",{attrs:{type:"primary",size:"medium",disabled:!e.ableCreate},on:{click:e.makeFile}},[e._v("\n        生成文件\n      ")])],1),e._v(" "),a("div",{staticClass:"operate-space"},[a("el-select",{attrs:{placeholder:"请选择"},model:{value:e.thisFile,callback:function(t){e.thisFile=t},expression:"thisFile"}},e._l(e.fileLists,function(e){return a("el-option",{key:e.file_id,attrs:{disabled:100!==e.process,label:e.file_name,value:e.file_id}})})),e._v(" "),a("el-button",{staticClass:"el-icon-refresh",attrs:{type:"primary",size:"medium"},on:{click:e.getFileLists}}),e._v(" "),a("el-button",{staticStyle:{"margin-left":"0px"},attrs:{type:"primary",size:"medium"},on:{click:e.downLoadFile}},[e._v("\n        导出文件\n      ")])],1)])])},staticRenderFns:[]};var E=a("VU/8")(_,C,!1,function(e){a("hF0D")},"data-v-f8ec509a",null);t.default=E.exports},fZjL:function(e,t,a){e.exports={default:a("jFbC"),__esModule:!0}},hF0D:function(e,t){},jFbC:function(e,t,a){a("Cdx3"),e.exports=a("FeBl").Object.keys},uqUo:function(e,t,a){var l=a("kM2E"),i=a("FeBl"),s=a("S82l");e.exports=function(e,t){var a=(i.Object||{})[e]||Object[e],n={};n[e]=t(a),l(l.S+l.F*s(function(){a(1)}),"Object",n)}}});