webpackJsonp([29],{EEwU:function(e,s,t){"use strict";Object.defineProperty(s,"__esModule",{value:!0});var a=t("Xxa5"),r=t.n(a),n=t("exGp"),i=t.n(n),o=t("sF3y"),c=t("UuhT"),l={name:"message_write",data:function(){return{message:{receivers:[],title:"",message:"",sender:""},rules:{receivers:[{required:!0,message:"请至少选择一个发送对象",trigger:"focus"}],title:[{required:!0,message:"消息主题不能为空",trigger:"focus"},{min:1,max:15,message:"字数在15字以内",trigger:"change"}],message:[{required:!0,message:"消息正文不能为空",trigger:"focus"}]},userOptions:[{label:"001",value:"12323123"}],me:""}},methods:{getUser:function(){var e=this;return i()(r.a.mark(function s(){var t,a;return r.a.wrap(function(s){for(;;)switch(s.prev=s.next){case 0:return t={pageSize:100,currentPage:1},s.next=3,Object(o.e)(t);case 3:"SUCCESS"===(a=s.sent).data.mitiStatus?e.initUserOptions(a.data.entity.data):e.$message.error("ERROR: "+a.data.message);case 5:case"end":return s.stop()}},s,e)}))()},faMessage:function(e){var s=this;return i()(r.a.mark(function t(){var a;return r.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,Object(c.f)(e);case 2:"SUCCESS"===(a=t.sent).data.mitiStatus?s.$message.success(a.data.entity):s.$message.error("ERROR: "+a.data.message);case 4:case"end":return t.stop()}},t,s)}))()},initUserOptions:function(e){var s=this,t=[];e.forEach(function(e){if("正常"===e.status&&e.id!==s.me.id){var a={username:e.username,name:e.name,id:e.id};t.push(a)}}),this.userOptions=t},sendMessage:function(e){var s=this;this.$refs[e].validate(function(e){if(!e)return!1;var t=[];s.message.receivers.forEach(function(e,a){s.userOptions.forEach(function(s){e.split("/")[1]===s.username&&t.push(s.id)})});var a=s.message;s.message={receivers:[],title:"",message:"",sender:s.me.id,type:1},a.receivers=t,a.type=1,s.faMessage(a)})}},mounted:function(){this.me=this.$store.state.user,this.message.sender=this.me.id,this.getUser()},computed:{}},u={render:function(){var e=this,s=e.$createElement,t=e._self._c||s;return t("div",{attrs:{id:"write"}},[t("el-form",{ref:"messagePen",attrs:{rules:e.rules,model:e.message,"label-position":"left","label-width":"80px"}},[t("el-form-item",{attrs:{prop:"receivers",label:"发送对象"}},[t("el-select",{staticStyle:{"margin-right":"20px",width:"100%"},attrs:{filterable:"",multiple:"","collapse-tags":"",placeholder:"请搜索用户账号/姓名或选择用户列表"},model:{value:e.message.receivers,callback:function(s){e.$set(e.message,"receivers",s)},expression:"message.receivers"}},e._l(e.userOptions,function(s,a){return t("el-option",{key:a,attrs:{laebl:s.name+"/"+s.username,value:s.name+"/"+s.username}},[t("span",{staticStyle:{float:"left",color:"#8492a6","font-size":"11px"}},[e._v(e._s("账号："+s.username))]),e._v(" "),t("span",{staticStyle:{float:"right",color:"#8492a6","font-size":"11px","margin-right":"20px"}},[e._v(e._s("姓名："+s.name))])])}))],1),e._v(" "),t("el-form-item",{attrs:{prop:"title",label:"消息主题"}},[t("el-input",{model:{value:e.message.title,callback:function(s){e.$set(e.message,"title",s)},expression:"message.title"}})],1),e._v(" "),t("el-form-item",{attrs:{prop:"message",label:"消息正文"}},[t("el-input",{attrs:{type:"textarea",autosize:{minRows:6,maxRows:12}},model:{value:e.message.message,callback:function(s){e.$set(e.message,"message",s)},expression:"message.message"}})],1)],1),e._v(" "),t("el-button",{staticClass:"float-right",attrs:{type:"primary",icon:"ercp-icon-general-send"},on:{click:function(s){e.sendMessage("messagePen")}}},[e._v(" 发送消息")])],1)},staticRenderFns:[]};var m=t("VU/8")(l,u,!1,function(e){t("nqIv")},"data-v-4dbba2ec",null);s.default=m.exports},nqIv:function(e,s){}});