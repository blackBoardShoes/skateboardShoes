webpackJsonp([12],{"OyV+":function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var a=r("Xxa5"),n=r.n(a),s=r("exGp"),i=r.n(s),o=r("sF3y"),c=r("YaB9"),u={name:"Project_detail_member",props:{selfBuild:{type:Boolean,required:!0},projectInfo:{type:Object,required:!0},projectId:{type:String,required:!0}},data:function(){return{tableData:[],addedMember:[],memberOptions:[],projectMes:{creator:"王二虎"},user:{},memberArr:[]}},methods:{removeMember:function(e){var t=this;return i()(n.a.mark(function r(){var a,s;return n.a.wrap(function(r){for(;;)switch(r.prev=r.next){case 0:return a={userId:t.$store.state.user.id,projectId:t.projectId,memberId:e.id},r.next=3,Object(c.m)(a);case 3:"SUCCESS"===(s=r.sent).data.mitiStatus?t.getProjectMem():t.$message.error("ERROR: "+s.data.message);case 5:case"end":return r.stop()}},r,t)}))()},add:function(){var e=this;return i()(n.a.mark(function t(){var r,a,s;return n.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:if(!e.addedMember){t.next=12;break}return r=[],e.addedMember.forEach(function(t,a){e.memberOptions.forEach(function(e){t.split("/")[1]===e.username&&r.push(e.id)})}),a={userId:e.$store.state.user.id,projectId:e.projectId,members:r},t.next=8,Object(c.b)(a);case 8:"SUCCESS"===(s=t.sent).data.mitiStatus?(e.addedMember=[],e.getProjectMem()):e.$message.error("ERROR: "+s.data.message),t.next=13;break;case 12:e.$message.warning("请选择一个成员");case 13:case"end":return t.stop()}},t,e)}))()},getAllUser:function(){var e=this;return i()(n.a.mark(function t(){var r,a;return n.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return r={currentPage:1,pageSize:500},t.next=3,Object(o.e)(r);case 3:"SUCCESS"===(a=t.sent).data.mitiStatus?(e.memberArr=a.data.entity.data,e.memberOptions=[],e.memberArr.forEach(function(t){if("正常"===t.status&&("管理员"===t.type||"科研管理员"===t.type||"医生"===t.type)){var r={username:t.username,name:t.name,id:t.id};e.memberOptions.push(r)}})):e.$message.error("ERROR: "+a.data.message);case 5:case"end":return t.stop()}},t,e)}))()},getProjectMem:function(){var e=this;return i()(n.a.mark(function t(){var r,a,s,i;return n.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return r=e.projectId,t.next=3,Object(c.i)(r);case 3:"SUCCESS"===(a=t.sent).data.mitiStatus?(s=a.data.entity,i=[],s.forEach(function(e){e.t1.joinTime=e.t2,i.push(e.t1)}),e.getUsers(),e.tableData=i):e.$message.error("ERROR: "+a.data.message);case 5:case"end":return t.stop()}},t,e)}))()},initMemberOptions:function(){var e=this;this.memberOptions=[],this.memberArr.forEach(function(t){if(t.username!==e.user.username&&"正常"===t.status&&("管理员"===t.type||"科研管理员"===t.type||"医生"===t.type)&&e.tableData.findIndex(function(e){return e.id===t.id})<0){var r={username:t.username,name:t.name,id:t.id,type:t.type};e.memberOptions.push(r)}})},getUsers:function(){var e=this;return i()(n.a.mark(function t(){var r,a;return n.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return r={currentPage:1,pageSize:500},t.next=3,Object(o.e)(r);case 3:"SUCCESS"===(a=t.sent).data.mitiStatus?(e.memberArr=a.data.entity.data,e.initMemberOptions(e.memberArr)):e.$message.error("ERROR: "+a.data.message);case 5:case"end":return t.stop()}},t,e)}))()}},mounted:function(){this.getProjectMem(),this.user=this.$store.state.user}},m={render:function(){var e=this,t=e.$createElement,r=e._self._c||t;return r("div",{attrs:{id:"project-member"}},[e.selfBuild?r("div",{staticClass:"operate-buttons align-right"},[r("el-select",{staticStyle:{"margin-right":"20px",flex:"1"},attrs:{filterable:"",multiple:"","collapse-tags":"",placeholder:"请搜索成员或选择成员列表"},model:{value:e.addedMember,callback:function(t){e.addedMember=t},expression:"addedMember"}},e._l(e.memberOptions,function(t,a){return r("el-option",{key:a,attrs:{laebl:t.name+"/"+t.username,value:t.name+"/"+t.username}},[r("span",{staticStyle:{float:"left",color:"#8492a6","font-size":"11px"}},[e._v(e._s("姓名："+t.name+"("+t.type+")"))]),e._v(" "),r("span",{staticStyle:{float:"right",color:"#8492a6","font-size":"11px","margin-right":"20px"}},[e._v(e._s("账号："+t.username))])])})),e._v(" "),r("el-button",{attrs:{size:"medium",type:"primary"},on:{click:e.add}},[e._v("添加成员")])],1):e._e(),e._v(" "),r("div",{staticClass:"project-info"},[r("el-table",{staticClass:"absolute-table",staticStyle:{width:"100%"},attrs:{"default-sort":{prop:"username",order:"descending"},data:e.tableData,height:"100%",size:"large",fit:""}},[r("el-table-column",{attrs:{prop:"username",align:"center",label:"账号"}}),e._v(" "),r("el-table-column",{attrs:{prop:"name",align:"center",label:"姓名"}}),e._v(" "),r("el-table-column",{attrs:{prop:"gender",align:"center",label:"性别"}}),e._v(" "),r("el-table-column",{attrs:{prop:"department",align:"center",label:"科室"}}),e._v(" "),r("el-table-column",{attrs:{prop:"username",align:"center",label:"角色"},scopedSlots:e._u([{key:"default",fn:function(t){return[r("span",[e._v(e._s(t.row.username===e.user.username?"负责人":"研究员"))])]}}])}),e._v(" "),r("el-table-column",{attrs:{"show-overflow-tooltip":"",prop:"joinTime",align:"center",label:"加入日期"}}),e._v(" "),r("el-table-column",{attrs:{align:"center",label:"操作",fixed:"right",width:"120"},scopedSlots:e._u([{key:"default",fn:function(t){return t.row.username!==e.user.username&&e.user.id===e.projectInfo.creator?[r("el-button",{attrs:{type:"danger",size:"small",plain:""},on:{click:function(r){e.removeMember(t.row)}}},[e._v("移除")])]:void 0}}])})],1)],1)])},staticRenderFns:[]};var l=r("VU/8")(u,m,!1,function(e){r("zggN")},"data-v-fce527dc",null);t.default=l.exports},zggN:function(e,t){}});